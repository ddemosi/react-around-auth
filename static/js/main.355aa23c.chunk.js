(this["webpackJsonpreact-around-auth"]=this["webpackJsonpreact-around-auth"]||[]).push([[0],{18:function(e,t,a){},21:function(e,t,a){e.exports=a.p+"static/media/logo.8f7611ae.svg"},23:function(e,t,a){e.exports=a.p+"static/media/edit-pencil.d476a8b8.svg"},26:function(e,t,a){e.exports=a(36)},36:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(20),i=a.n(o),c=(a(18),a(24)),l=a(3),s=a(7),m=a(1),u=a(21),d=a.n(u);var f=function(e){function t(){localStorage.removeItem("token"),e.setEmail(""),window.location.reload()}function a(){e.toggleHamburgerState(!e.hamburger)}return r.a.createElement("header",{className:"header width ".concat(e.hamburger?"header_hamburger_active":"")},r.a.createElement("img",{className:"logo",src:d.a,alt:"Around the US Logo"}),e.link?r.a.createElement(s.b,{className:"header__link",to:e.link},e.name):e.email?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"header__email ".concat(e.hamburger?"header__email_hamburger_active":"")},e.email),r.a.createElement("button",{onClick:t,className:"header__logout ".concat(e.hamburger?"header__logout_hamburger_active":"")},"Log Out"),r.a.createElement("button",{onClick:a,className:"header__hamburger ".concat(e.hamburger?"header__hamburger_active":"")})):null)},h=a(23),_=a.n(h),p=r.a.createContext();var g=function(e){var t=Object(n.useContext)(p),a=e.cardOwnerId===t._id,o=e.cardLikes.some((function(e){return e._id===t._id}));return r.a.createElement("li",{className:"element"},r.a.createElement("button",{className:"element__delete ".concat(a?"element__delete_visible":""),onClick:function(){e.handleDeleteClick(e.cardId)}}),r.a.createElement("div",{className:"element__image",onClick:function(){e.handleCardClick(e.cardLink,e.cardName)},style:{backgroundImage:"url(".concat(e.cardLink,")")}}),r.a.createElement("div",{className:"element__title-container"},r.a.createElement("h2",{className:"element__title"},e.cardName),r.a.createElement("div",{className:"element__like-container"},r.a.createElement("button",{className:"element__like-button ".concat(o?"element__like-button_active":""),onClick:function(){e.onCardLike(e.cardLikes,e.cardId)}}),r.a.createElement("p",{className:"element__like-counter"},e.cardLikes.length))))};var v=function(e){var t=Object(n.useContext)(p);return r.a.createElement("main",{className:"main"},r.a.createElement("section",{className:"profile width"},r.a.createElement("div",{className:"profile__avatar-container"},r.a.createElement("img",{className:"profile__avatar",src:t.avatar,alt:"Your profile"}),r.a.createElement("div",{className:"profile__overlay"},r.a.createElement("img",{className:"profile__overlay-image",src:_.a,alt:"pencil",onClick:e.handleEditAvatarClick}))),r.a.createElement("div",{className:"profile__name-container"},r.a.createElement("h2",{className:"profile__name"},t.name),r.a.createElement("button",{className:"profile__edit-button",onClick:e.handleEditProfileClick}),r.a.createElement("p",{className:"profile__subtitle"},t.about)),r.a.createElement("button",{className:"form__save-button profile__add-button",onClick:e.handleAddCardClick})),r.a.createElement("section",{className:"elements width"},r.a.createElement("ul",{className:"elements__grid-container"},e.cards.map((function(t){return r.a.createElement(g,{key:t.id,cardName:t.name,cardId:t.id,cardOwnerId:t.ownerId,cardLink:t.link,cardLikes:t.likes,onCardLike:e.handleCardLike,handleDeleteClick:e.handleDeleteClick,handleCardClick:e.handleCardClick})})))))};var E=function(){return r.a.createElement("footer",{className:"footer width"},r.a.createElement("p",{className:"footer__copyright"},"\xa9 2020 Danny Demosi"))};var b=function(e){return r.a.createElement("section",{className:"image-modal ".concat(e.isOpen?"image-modal_visible":"")},r.a.createElement("div",{className:"image-modal__container "},r.a.createElement("button",{className:"modal__exit image-modal__exit",onClick:e.onClose}),r.a.createElement("img",{className:"image-modal__image",src:e.link,alt:e.name}),r.a.createElement("p",{className:"image-modal__subtitle"},e.name)))},k=a(12),N=a(13),C=new(function(){function e(t){Object(k.a)(this,e),this._apiEndpoint=t.url,this._auth=t.headers}return Object(N.a)(e,[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._apiEndpoint,"/users/me"),{headers:this._auth}).then((function(t){return e._checkResponse(t)}))}},{key:"getCardList",value:function(){var e=this;return fetch("".concat(this._apiEndpoint,"/cards"),{headers:this._auth}).then((function(t){return e._checkResponse(t)}))}},{key:"changeProfileInfo",value:function(e){var t=this;return fetch("".concat(this._apiEndpoint,"/users/me"),{method:"PATCH",headers:this._auth,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return t._checkResponse(e)}))}},{key:"addCard",value:function(e){var t=this;return fetch("".concat(this._apiEndpoint,"/cards"),{method:"POST",headers:this._auth,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t._checkResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._apiEndpoint,"/cards/").concat(e),{method:"DELETE",headers:this._auth}).then((function(e){return t._checkResponse(e)}))}},{key:"changeLikeCardStatus",value:function(e,t){var a=this;return!0===t?fetch("".concat(this._apiEndpoint,"/cards/likes/").concat(e),{method:"PUT",headers:this._auth}).then((function(e){return a._checkResponse(e)})):fetch("".concat(this._apiEndpoint,"/cards/likes/").concat(e),{method:"DELETE",headers:this._auth}).then((function(e){return a._checkResponse(e)}))}},{key:"updateAvatar",value:function(e){var t=this;return fetch("".concat(this._apiEndpoint,"/users/me/avatar"),{method:"PATCH",headers:this._auth,body:JSON.stringify({avatar:e})}).then((function(e){return t._checkResponse(e)}))}}]),e}())({url:"https://around.nomoreparties.co/v1/group-3",headers:{authorization:"98dd8ac9-99ea-4ab0-85f9-6d61f9934e14","Content-Type":"application/json"}}),O=new(function(){function e(t){Object(k.a)(this,e),this._apiEndpoint=t.url,this._headers=t.headers}return Object(N.a)(e,[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._apiEndpoint,"/users/me"),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"signUp",value:function(e,t){var a=this;return fetch("".concat(this._apiEndpoint,"/signup"),{method:"POST",headers:this._headers,body:JSON.stringify({email:e,password:t})}).then((function(e){return a._checkResponse(e)}))}},{key:"signIn",value:function(e,t){var a=this;return fetch("".concat(this._apiEndpoint,"/signin"),{method:"POST",headers:this._headers,body:JSON.stringify({email:e,password:t})}).then((function(e){return a._checkResponse(e)}))}},{key:"checkToken",value:function(e){return fetch("".concat(this._apiEndpoint,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})}}]),e}())({url:"https://register.nomoreparties.co",headers:{"Content-Type":"application/json"}});var S=function(e){return r.a.createElement("form",{name:e.name,onSubmit:e.onSubmit,className:"form form_".concat(e.name," ").concat(e.isOpen?"form_visible":"")},r.a.createElement("button",{className:"modal__exit form__exit form__exit_".concat(e.name),onClick:e.onClose,type:"reset"}),r.a.createElement("p",{className:"form__title form-width"},e.title),e.children)};var w=function(e){var t=Object(n.useContext)(p),a=r.a.createRef(),o=r.a.createRef();return r.a.createElement(S,{onSubmit:function(t){t.preventDefault();var n=a.current.value,r=o.current.value;e.onUpdateUser(n,r)},name:"edit-profile",title:"Edit Profile",isOpen:e.isOpen,onClose:e.onClose},r.a.createElement("div",{className:"form__text-field-wrapper form-width"},r.a.createElement("input",{ref:a,id:"profile-name",className:"form__text-field form__input form__input_name",placeholder:"Name",type:"text",defaultValue:t.name,minLength:"2",maxLength:"40",required:!0}),r.a.createElement("span",{id:"profile-name-error",className:"form__error"})),r.a.createElement("div",{className:"form__text-field-wrapper form-width"},r.a.createElement("input",{ref:o,id:"profile-about",className:"form__text-field form__input form__input_about",placeholder:"About me",type:"text",defaultValue:t.about,minLength:"2",maxLength:"200",required:!0}),r.a.createElement("span",{id:"profile-about-error",className:"form__error"})),r.a.createElement("button",{type:"submit",className:"form__save-button form__save-button_profile form-width"},e.isSaving?"Saving...":"Save"))};var y=function(e){var t=Object(n.useContext)(p),a=r.a.createRef();return r.a.createElement(S,{name:"update-avatar",title:"Edit Avatar",onSubmit:function(t){t.preventDefault();var n=a.current.value;e.onUpdateAvatar(n)},isOpen:e.isOpen,onClose:e.onClose},r.a.createElement("div",{className:"form__text-field-wrapper form-width"},r.a.createElement("input",{ref:a,id:"avatar-link",className:"form__text-field form__input form__input_avatar-link",placeholder:"Image URL",type:"url",defaultValue:t.avatar,minLength:"1"}),r.a.createElement("span",{id:"avatar-link-error",className:"form__error"})),r.a.createElement("button",{type:"submit",className:"form__save-button form__save-button_avatar-link form-width"},e.isSaving?"Saving...":"Save"))};var j=function(e){var t=r.a.createRef(),a=r.a.createRef();return r.a.createElement(S,{name:"card",title:"New Place",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault();var r=t.current.value,o=a.current.value;e.onAddPlace(r,o)}},r.a.createElement("div",{className:"form__text-field-wrapper form-width"},r.a.createElement("input",{ref:t,id:"image-title",className:"form__text-field form__input form__input_image-title",placeholder:"Title",type:"text",defaultValue:"",minLength:"1",maxLength:"30"}),r.a.createElement("span",{id:"image-title-error",className:"form__error"})),r.a.createElement("div",{className:"form__text-field-wrapper form-width"},r.a.createElement("input",{ref:a,id:"image-link",className:"form__text-field form__input form__input_image-link",placeholder:"Image URL",type:"url",defaultValue:"",minLength:"1"}),r.a.createElement("span",{id:"image-link-error",className:"form__error"})),r.a.createElement("button",{type:"submit",className:"form__save-button form__save-button_card form-width"},e.isSaving?"Saving...":"Create"))};var I=function(e){return r.a.createElement(S,{name:"confirm",title:"Are you sure?",onSubmit:function(t){t.preventDefault(),e.onCardDelete(e.confirmDeleteId)},isOpen:e.isOpen,onClose:e.onClose},r.a.createElement("button",{type:"submit",className:"form__save-button form__save-button_avatar-link form-width"},e.isSaving?"Saving...":"Yes"))},L=function(e){var t=r.a.createRef(),a=r.a.createRef();return r.a.createElement("form",null,r.a.createElement("input",{ref:t,className:"auth__input",type:"text",placeholder:"Email"}),r.a.createElement("input",{ref:a,className:"auth__input",type:"text",placeholder:"Password"}),r.a.createElement("button",{onClick:function(n){n.preventDefault(),O.signUp(t.current.value,a.current.value).then((function(t){return 400===t.status?Promise.reject(new Error("The username or password is not in the proper format")):(e.setRegistrationSuccess(!0),e.toggleInfoTooltip(!0),e.toggleLoggedIn(!0),t.data)})).then((function(t){e.setEmail(t.email)})).catch((function(t){console.log(t),e.setRegistrationSuccess(!1),e.toggleInfoTooltip(!0)}))},type:"submit",className:"auth__submit"},e.name))},x=function(e){var t=r.a.createRef(),a=r.a.createRef();return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{ref:t,className:"auth__input",type:"text",placeholder:"Email"}),r.a.createElement("input",{ref:a,className:"auth__input",type:"text",placeholder:"Password"}),r.a.createElement("button",{onClick:function(n){n.preventDefault();var r=t.current.value;O.signIn(t.current.value,a.current.value).then((function(t){return 400===t.status?Promise.reject(new Error("The username or password was not provided")):401===t.status?Promise.reject(new Error("Could not find a user with that email")):(e.toggleLoggedIn(!0),t)})).then((function(t){e.setEmail(r),localStorage.setItem("email",r),localStorage.setItem("token",t.token)})).catch((function(e){console.log(e)}))},className:"auth__submit",type:"submit"},e.name))},R=function(e){return r.a.createElement("div",{className:"auth width"},r.a.createElement("h2",{className:"auth__title"},e.name),"Sign Up"===e.name?r.a.createElement(L,{name:e.name,setRegistrationSuccess:e.setRegistrationSuccess,toggleInfoTooltip:e.toggleInfoTooltip,toggleLoggedIn:e.toggleLoggedIn,email:e.email,setEmail:e.setEmail}):"Log in"===e.name?r.a.createElement(x,{name:e.name,setRegistrationSuccess:e.setRegistrationSuccess,toggleInfoTooltip:e.toggleInfoTooltip,toggleLoggedIn:e.toggleLoggedIn,email:e.email,setEmail:e.setEmail}):(console.log("Component doesn't exist"),null),r.a.createElement("p",{className:"auth__button-description"},e.buttonDescription," ",r.a.createElement(s.b,{className:"auth__link",to:e.link},e.linkName," here!")))},T=a(25),P=function(e){var t=e.component,a=Object(T.a)(e,["component"]);return r.a.createElement(m.b,null,(function(){return a.isLoggedIn?r.a.createElement(t,a):r.a.createElement(m.a,{to:"/login"})}))},D=function(e){var t=Object(n.useState)(""),a=Object(l.a)(t,2),o=a[0],i=a[1];return Object(n.useEffect)((function(){!0===e.registrationSuccess?i("Success! You have now been registered."):!1===e.registrationSuccess&&i("Oops, something went wrong! Please try again.")}),[e.registrationSuccess]),r.a.createElement("section",{className:"form info-tooltip ".concat(e.isOpen?"info-tooltip_visible":"")},r.a.createElement("div",{className:"form-width "},r.a.createElement("button",{className:"modal__exit image-modal__exit",onClick:e.onClose}),r.a.createElement("div",{className:"info-tooltip__image ".concat(e.registrationSuccess?"info-tooltip__image_success":"info-tooltip__image_fail")}),r.a.createElement("p",{className:"info-tooltip__message"},o)))};var U=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],o=t[1],i=Object(n.useState)(!1),u=Object(l.a)(i,2),d=u[0],h=u[1],_=Object(n.useState)(!1),g=Object(l.a)(_,2),k=g[0],N=g[1],S=Object(n.useState)(!1),L=Object(l.a)(S,2),x=L[0],T=L[1],U=Object(n.useState)(!1),A=Object(l.a)(U,2),J=A[0],V=A[1],H=Object(n.useState)(!1),B=Object(l.a)(H,2),Y=B[0],q=B[1],z=Object(n.useState)(""),F=Object(l.a)(z,2),W=F[0],G=F[1],M=Object(n.useState)({link:"",name:"",isOpen:!1}),$=Object(l.a)(M,2),K=$[0],Q=$[1],X=Object(n.useState)(!1),Z=Object(l.a)(X,2),ee=Z[0],te=Z[1],ae=Object(n.useState)([]),ne=Object(l.a)(ae,2),re=ne[0],oe=ne[1],ie=Object(n.useState)(!1),ce=Object(l.a)(ie,2),le=ce[0],se=ce[1],me=Object(n.useState)(""),ue=Object(l.a)(me,2),de=ue[0],fe=ue[1],he=Object(n.useState)(""),_e=Object(l.a)(he,2),pe=_e[0],ge=_e[1],ve=Object(n.useState)(!1),Ee=Object(l.a)(ve,2),be=Ee[0],ke=Ee[1];function Ne(e,t){te(!0),C.changeProfileInfo({name:e,about:t}).then((function(){Ce()})).catch((function(e){return console.log(e)})),te(!1),N(!1)}function Ce(){C.getUserInfo().then((function(e){o({name:e.name,about:e.about,avatar:e.avatar,_id:e._id})})).catch((function(e){return console.log(e)}))}function Oe(e){e.target===e.currentTarget&&(h(!1),N(!1),T(!1),V(!1),q(!1),Q({link:"",name:"",isOpen:!1}))}return Object(n.useEffect)((function(){localStorage.getItem("token")&&O.checkToken(localStorage.getItem("token")).then((function(e){return 400===e.status?(localStorage.removeItem("token"),localStorage.removeItem("email"),Promise.reject(new Error("No token or improper format"))):401===e.status?(localStorage.removeItem("token"),localStorage.removeItem("email"),Promise.reject(new Error("Invalid token"))):(se(!0),void ge(localStorage.getItem("email")))})).catch((function(e){console.log(e)}))}),[]),Object(n.useEffect)((function(){C.getUserInfo().then((function(e){var t={name:e.name,about:e.about,avatar:e.avatar,_id:e._id};return o(t),t})).then((function(e){C.getCardList().then((function(t){oe(t.map((function(t){return{name:t.name,link:t.link,likes:t.likes,id:t._id,ownerId:t.owner._id,myId:e._id}})))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}),[]),r.a.createElement(p.Provider,{value:a},r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"page"},r.a.createElement(s.a,null,r.a.createElement(m.d,null,r.a.createElement(m.b,{exact:!0,path:"/"},r.a.createElement(f,{email:pe,setEmail:ge,hamburger:be,toggleHamburgerState:ke}),r.a.createElement(P,{component:v,isLoggedIn:le,selectedCard:K,handleEditAvatarClick:function(e){h(!0)},handleEditProfileClick:function(e){N(!0)},handleAddCardClick:function(e){T(!0)},handleCardClick:function(e,t){Q({link:e,name:t,isOpen:!0})},setCards:oe,cards:re,handleDeleteClick:function(e){G(e),V(!0)},handleCardLike:function(e,t){var n=e.some((function(e){return e._id===a._id}));C.changeLikeCardStatus(t,!n).then((function(e){var a={name:e.name,link:e.link,likes:e.likes,id:e._id,ownerId:e.owner._id},n=re.map((function(e){return e.id===t?a:e}));oe(n)})).catch((function(e){return console.log(e)}))}})),r.a.createElement(m.b,{path:"/login"},r.a.createElement(f,{name:"Sign Up",link:"/register"}),le?r.a.createElement(m.a,{to:"/"}):r.a.createElement(R,{name:"Log in",link:"/register",linkName:"Sign up",toggleInfoTooltip:q,setRegistrationSuccess:fe,toggleLoggedIn:se,email:pe,setEmail:ge,buttonDescription:"Not a member yet?"})),r.a.createElement(m.b,{path:"/register"},r.a.createElement(f,{name:"Log in",link:"/login"}),le?r.a.createElement(m.a,{to:"/"}):r.a.createElement(R,{name:"Sign Up",link:"/login",linkName:"Log in",toggleInfoTooltip:q,setRegistrationSuccess:fe,toggleLoggedIn:se,email:pe,setEmail:ge,buttonDescription:"Already a member?"})))),r.a.createElement("section",{className:"modal ".concat(K.isOpen||d||k||x||J||Y?"modal_display_visible":""),onClick:Oe},r.a.createElement(y,{onUpdateAvatar:function(e){te(!0),C.updateAvatar(e).then((function(){Ce()})).catch((function(e){return console.log(e)})),te(!1),h(!1)},isOpen:d,onClose:Oe,isSaving:ee}),r.a.createElement(w,{onUpdateUser:Ne,isOpen:k,onClose:Oe,isSaving:ee}),r.a.createElement(j,{onUpdateUser:Ne,isOpen:x,onClose:Oe,onAddPlace:function(e,t){te(!0),C.addCard({name:e,link:t}).then((function(e){var t={name:e.name,link:e.link,likes:e.likes,id:e._id,ownerId:e.owner._id};oe([].concat(Object(c.a)(re),[t]))})).then((function(){te(!1),T(!1)})).catch((function(e){return console.log(e)}))},isSaving:ee}),r.a.createElement(I,{isOpen:J,onClose:Oe,onCardDelete:function(e){te(!0),C.deleteCard(e).then((function(){var t=re.filter((function(t){return t.id!==e}));oe(t)})).catch((function(e){return console.log(e)})),te(!1),V(!1)},confirmDeleteId:W,isSaving:ee}),r.a.createElement(b,{isOpen:K.isOpen,onClose:Oe,name:K.name,link:K.link}),r.a.createElement(D,{isOpen:Y,onClose:Oe,registrationSuccess:de})),r.a.createElement(E,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.355aa23c.chunk.js.map